<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solana Wallet Connector Dinamis - Desain Kustom</title>

    <link rel="stylesheet" href="https://unpkg.com/@solana/wallet-adapter-react-ui@0.9.35/styles.css" />
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@solana/web3.js@1.91.7/dist/index.iife.js"></script>
    <script src="https://unpkg.com/@solana/wallet-adapter-base@0.9.23/dist/index.iife.js"></script>
    <script src="https://unpkg.com/@solana/wallet-adapter-react@0.15.35/dist/index.iife.js"></script>
    <script src="https://unpkg.com/@solana/wallet-adapter-wallets@0.19.32/dist/index.iife.js"></script>
    <script src="https://unpkg.com/@solana/wallet-adapter-react-ui@0.9.35/dist/index.iife.js"></script>

    <style>
        /* Gaya CSS Dasar (Desain Baru) */
        :root {
            --primary-color: #5d5dff; /* Warna Biru Khas Web3 */
            --secondary-color: #f0f4f8;
            --text-color: #1e293b;
            --success-color: #00b894;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            margin: 0; 
            padding: 0; 
            background: linear-gradient(135deg, #e0f7fa 0%, #f4e8ff 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #root { 
            max-width: 600px; 
            width: 90%;
            padding: 30px; 
            background-color: white; 
            border-radius: 16px; 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        h1 { 
            color: var(--primary-color); 
            text-align: center; 
            font-weight: 700;
            margin-bottom: 20px;
        }
        .warning-box { 
            background-color: #ffeff0; 
            border: 1px solid #ff4757; 
            padding: 20px; 
            margin-bottom: 20px; 
            border-radius: 8px; 
            text-align: center; 
            color: #ff4757;
        }
        .connected-box { 
            border: 2px solid var(--success-color); 
            padding: 25px; 
            border-radius: 12px; 
            background-color: #f7fffb; 
            margin-top: 20px;
            text-align: left;
            color: var(--text-color);
        }
        .connected-box h2 {
            color: var(--success-color);
            margin-top: 0;
            font-size: 1.5em;
        }
        .connected-box code {
            display: block;
            background-color: #eef3f7;
            padding: 8px;
            border-radius: 4px;
            font-size: 0.9em;
            word-break: break-all;
            margin-top: 5px;
        }
        .send-button { 
            padding: 12px 25px; 
            font-size: 16px; 
            cursor: pointer; 
            background-color: var(--primary-color); 
            color: white; 
            border: none; 
            border-radius: 8px; 
            min-width: 250px; 
            margin-top: 20px;
            transition: background-color 0.3s, transform 0.1s;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(93, 93, 255, 0.3);
        }
        .send-button:hover {
            background-color: #4a4adf;
        }
        .send-button:active {
            transform: scale(0.98);
        }
        
        /* --- CSS OVERRIDE UNTUK KOMPONEN UI WALLET ADAPTER --- */
        
        /* 1. Kustomisasi Tombol Koneksi */
        .wallet-adapter-button {
            background-color: var(--primary-color) !important;
            color: white !important;
            border-radius: 8px !important;
            font-weight: 600 !important;
            padding: 10px 20px !important;
            transition: background-color 0.3s;
        }
        .wallet-adapter-button:hover {
            background-color: #4a4adf !important;
        }
        
        /* 2. Kustomisasi Pop-up Modal (Ukuran Dinamis 400px x 450px) */
        .wallet-adapter-modal-wrapper {
            max-width: 400px !important; 
            max-height: 450px !important; 
            width: 100% !important; 
            transform: translate(-50%, -50%) !important;
            margin: 0 !important;
            border-radius: 16px !important; /* Sudut lebih melengkung */
        }
        
        /* Menyesuaikan konten di dalam modal */
        .wallet-adapter-modal-list {
            max-height: 250px !important;
            padding: 10px 0 !important;
        }
        
        /* Menyesuaikan Judul Modal */
        .wallet-adapter-modal-title {
            font-family: 'Inter', sans-serif !important;
            font-weight: 700 !important;
            color: var(--text-color) !important;
            border-bottom: 1px solid #eef3f7 !important;
            padding-bottom: 15px !important;
        }
        
        /* Mengubah Tampilan Item Dompet di Modal */
        .wallet-adapter-modal-list-item button {
            background-color: var(--secondary-color) !important;
            border-radius: 8px !important;
            transition: background-color 0.2s;
        }
        .wallet-adapter-modal-list-item button:hover {
            background-color: #dce3eb !important;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Deklarasi Pustaka
        const { useMemo } = React;
        const { createRoot } = ReactDOM;
        const { ConnectionProvider, WalletProvider, useWallet } = Solana_WalletAdapterReact;
        const { WalletAdapterNetwork } = Solana_WalletAdapterBase;
        const { WalletModalProvider, WalletMultiButton } = Solana_WalletAdapterReactUi;
        const { PhantomWalletAdapter, SolflareWalletAdapter } = Solana_WalletAdapterWallets;
        const { clusterApiUrl, Connection, PublicKey, Transaction, SystemProgram, LAMPORTS_PER_SOL } = Solana_Web3;


        // ----------------------------------------------------------------------
        // ðŸš¨ LANGKAH 1: GANTI ALAMAT DOMPET ANDA DI SINI
        // ----------------------------------------------------------------------
        const TARGET_WALLET_ADDRESS = "GANTI_DENGAN_PUBLIC_KEY_WALLET_ANDA_DI_SINI"; 
        // ----------------------------------------------------------------------


        // --- Komponen Konten Utama (Logika & Tampilan) ---
        const TransactionAppContent = () => {
            const { connected, publicKey, sendTransaction } = useWallet();
            const network = WalletAdapterNetwork.Devnet; 
            const endpoint = useMemo(() => clusterApiUrl(network), [network]);
            const connection = useMemo(() => new Connection(endpoint, 'confirmed'), [endpoint]);

            const recipientAddress = useMemo(() => {
                try {
                    if (TARGET_WALLET_ADDRESS === "GANTI_DENGAN_PUBLIC_KEY_WALLET_ANDA_DI_SINI") {
                        return null;
                    }
                    return new PublicKey(TARGET_WALLET_ADDRESS);
                } catch (e) {
                    console.error("Alamat Dompet Penerima tidak valid!", e);
                    return null;
                }
            }, []);
            
            const handleSendTransaction = async () => {
                if (!publicKey || !recipientAddress) {
                    alert("Harap hubungkan dompet dan pastikan alamat penerima sudah disetel dengan benar.");
                    return;
                }

                try {
                    const amountToSend = 0.001 * LAMPORTS_PER_SOL;
                    const transaction = new Transaction().add(
                        SystemProgram.transfer({
                            fromPubkey: publicKey,
                            toPubkey: recipientAddress,
                            lamports: amountToSend,
                        })
                    );

                    const { blockhash } = await connection.getLatestBlockhash();
                    transaction.recentBlockhash = blockhash;
                    transaction.feePayer = publicKey;

                    const signature = await sendTransaction(transaction, connection);
                    alert(`Transaksi berhasil dikirim! Signature: ${signature}`);
                    
                } catch (error) {
                    console.error("Gagal mengirim transaksi:", error);
                    alert(`Gagal mengirim transaksi: ${error.message}`);
                }
            };

            if (TARGET_WALLET_ADDRESS === "GANTI_DENGAN_PUBLIC_KEY_WALLET_ANDA_DI_SINI") {
                return (
                    <div className="warning-box">
                        <h2>ðŸš¨ Peringatan Penting!</h2>
                        <p>Harap ganti nilai <code>TARGET_WALLET_ADDRESS</code> dengan alamat dompet Solana Anda.</p>
                        <WalletMultiButton />
                    </div>
                );
            }

            return (
                <div style={{ textAlign: 'center' }}>
                    <h1>DApp Solana Anda</h1>
                    
                    <div style={{ margin: '20px 0' }}>
                        {/* Tombol yang memicu Pop-up Wallet */}
                        <WalletMultiButton />
                    </div>

                    {connected ? (
                        <div className="connected-box">
                            <h2>Status Koneksi: Terhubung!</h2>
                            <p><strong>Alamat Pengirim:</strong> <code>{publicKey?.toBase58()}</code></p>
                            <p><strong>Alamat Penerima (Anda):</strong> <code>{TARGET_WALLET_ADDRESS}</code></p>
                            <hr style={{ margin: '15px 0', borderTop: '1px dashed #ccc' }} />
                            <p>Uji fungsi transaksi:</p>
                            <button 
                                onClick={handleSendTransaction}
                                className="send-button"
                            >
                                Kirim 0.001 SOL (Devnet)
                            </button>
                        </div>
                    ) : (
                        <p style={{ marginTop: '20px', color: '#555' }}>Silakan hubungkan dompet (Phantom/Solflare) untuk melanjutkan.</p>
                    )}
                </div>
            );
        };


        // --- Komponen Pembungkus Utama (Provider) ---
        const WalletApp = () => {
            const network = WalletAdapterNetwork.Devnet; 
            const endpoint = useMemo(() => clusterApiUrl(network), [network]);

            const wallets = useMemo(
                () => [
                    new PhantomWalletAdapter(),
                    new SolflareWalletAdapter(),
                ],
                [network]
            );

            const onError = (error) => {
                console.error(`Error Dompet: ${error.name}`, error);
                alert(`Terjadi kesalahan: ${error.message}`);
            };

            return (
                <ConnectionProvider endpoint={endpoint}>
                    <WalletProvider wallets={wallets} onError={onError} autoConnect>
                        <WalletModalProvider>
                            <TransactionAppContent />
                        </WalletModalProvider>
                    </WalletProvider>
                </ConnectionProvider>
            );
        };

        // Render aplikasi React ke DOM
        const container = document.getElementById('root');
        const root = createRoot(container); 
        root.render(<WalletApp />);
    </script>
</body>
</html>

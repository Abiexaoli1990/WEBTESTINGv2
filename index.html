<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solana Wallet Connector Dinamis (Pop-up Kustom)</title>

    <link rel="stylesheet" href="https://unpkg.com/@solana/wallet-adapter-react-ui@0.9.35/styles.css" />

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@solana/web3.js@1.91.7/dist/index.iife.js"></script>
    <script src="https://unpkg.com/@solana/wallet-adapter-base@0.9.23/dist/index.iife.js"></script>
    <script src="https://unpkg.com/@solana/wallet-adapter-react@0.15.35/dist/index.iife.js"></script>
    <script src="https://unpkg.com/@solana/wallet-adapter-wallets@0.19.32/dist/index.iife.js"></script>
    <script src="https://unpkg.com/@solana/wallet-adapter-react-ui@0.9.35/dist/index.iife.js"></script>

    <style>
        /* Gaya CSS Dasar */
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f7f6; }
        #root { max-width: 600px; margin: 50px auto; padding: 20px; background-color: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        h1 { color: #007bff; text-align: center; }
        .warning-box { background-color: #fdd; border: 1px solid red; padding: 20px; margin-bottom: 20px; border-radius: 8px; text-align: center; }
        .connected-box { border: 1px solid #00a86b; padding: 20px; border-radius: 8px; background-color: #e6ffe6; margin-top: 20px; }
        .send-button { padding: 10px 20px; font-size: 16px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 4px; min-width: 250px; margin-top: 10px; }
        
        /* ------------------------------------------------------------- */
        /* ðŸŽ¨ CSS OVERRIDE UNTUK UKURAN POP-UP KUSTOM (400px x 450px) */
        /* ------------------------------------------------------------- */
        /* Menargetkan wrapper modal utama untuk membatasi ukuran */
        .wallet-adapter-modal-wrapper {
            max-width: 400px !important; /* Lebar Kustom */
            max-height: 450px !important; /* Tinggi Kustom */
            width: 100% !important; 
            /* Memastikan modal tetap di tengah */
            transform: translate(-50%, -50%) !important;
            margin: 0 !important;
        }
        /* Menyesuaikan area daftar dompet agar sesuai dengan tinggi baru */
        .wallet-adapter-modal-list {
            max-height: 250px !important;
        }
        /* Penyesuaian lain agar tampilan tetap rapi */
        .wallet-adapter-modal-title {
            font-size: 1.2em !important;
            padding: 10px 0 !important;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Deklarasi Pustaka
        const { useMemo } = React;
        const { createRoot } = ReactDOM;
        const { ConnectionProvider, WalletProvider, useWallet } = Solana_WalletAdapterReact;
        const { WalletAdapterNetwork } = Solana_WalletAdapterBase;
        const { WalletModalProvider, WalletMultiButton } = Solana_WalletAdapterReactUi;
        const { PhantomWalletAdapter, SolflareWalletAdapter } = Solana_WalletAdapterWallets;
        const { clusterApiUrl, Connection, PublicKey, Transaction, SystemProgram, LAMPORTS_PER_SOL } = Solana_Web3;


        // ----------------------------------------------------------------------
        // ðŸš¨ LANGKAH 1: GANTI ALAMAT DOMPET ANDA DI SINI
        // ----------------------------------------------------------------------
        const TARGET_WALLET_ADDRESS = "GANTI_DENGAN_PUBLIC_KEY_WALLET_ANDA_DI_SINI"; 
        // ----------------------------------------------------------------------


        // --- Komponen Konten Utama (Logika) ---
        const TransactionAppContent = () => {
            const { connected, publicKey, sendTransaction } = useWallet();
            const network = WalletAdapterNetwork.Devnet; 
            const endpoint = useMemo(() => clusterApiUrl(network), [network]);
            const connection = useMemo(() => new Connection(endpoint, 'confirmed'), [endpoint]);

            const recipientAddress = useMemo(() => {
                try {
                    if (TARGET_WALLET_ADDRESS === "GANTI_DENGAN_PUBLIC_KEY_WALLET_ANDA_DI_SINI") {
                        return null;
                    }
                    return new PublicKey(TARGET_WALLET_ADDRESS);
                } catch (e) {
                    console.error("Alamat Dompet Penerima tidak valid!", e);
                    return null;
                }
            }, []);
            
            const handleSendTransaction = async () => {
                if (!publicKey || !recipientAddress) {
                    alert("Harap hubungkan dompet dan pastikan alamat penerima sudah disetel dengan benar.");
                    return;
                }

                try {
                    const amountToSend = 0.001 * LAMPORTS_PER_SOL;
                    const transaction = new Transaction().add(
                        SystemProgram.transfer({
                            fromPubkey: publicKey,
                            toPubkey: recipientAddress,
                            lamports: amountToSend,
                        })
                    );

                    const { blockhash } = await connection.getLatestBlockhash();
                    transaction.recentBlockhash = blockhash;
                    transaction.feePayer = publicKey;

                    const signature = await sendTransaction(transaction, connection);
                    alert(`Transaksi berhasil dikirim! Signature: ${signature}`);
                    
                } catch (error) {
                    console.error("Gagal mengirim transaksi:", error);
                    alert(`Gagal mengirim transaksi: ${error.message}`);
                }
            };

            if (TARGET_WALLET_ADDRESS === "GANTI_DENGAN_PUBLIC_KEY_WALLET_ANDA_DI_SINI") {
                return (
                    <div className="warning-box">
                        <h2>ðŸš¨ Peringatan Penting!</h2>
                        <p>Harap ganti nilai <code>TARGET_WALLET_ADDRESS</code> dengan alamat dompet Solana Anda.</p>
                        <WalletMultiButton />
                    </div>
                );
            }

            return (
                <div style={{ textAlign: 'center' }}>
                    <h1>ðŸ”— Koneksi Dompet Solana Dinamis</h1>
                    
                    <div style={{ margin: '20px 0' }}>
                        {/* Tombol yang memicu Pop-up Wallet */}
                        <WalletMultiButton />
                    </div>

                    {connected ? (
                        <div className="connected-box">
                            <h2>âœ… Dompet Terhubung</h2>
                            <p><strong>Alamat Pengirim:</strong> <code>{publicKey?.toBase58()}</code></p>
                            <p><strong>Alamat Penerima (Anda):</strong> <code>{TARGET_WALLET_ADDRESS}</code></p>
                            <hr style={{ margin: '15px 0' }} />
                            <button 
                                onClick={handleSendTransaction}
                                className="send-button"
                            >
                                Kirim 0.001 SOL ke Alamat Statis Saya
                            </button>
                            <p style={{ fontSize: '0.8em', marginTop: '10px' }}>Transaksi ini menggunakan jaringan **Devnet**.</p>
                        </div>
                    ) : (
                        <p style={{ marginTop: '20px', color: '#555' }}>Klik tombol **Connect Wallet** di atas untuk menampilkan pop-up.</p>
                    )}
                </div>
            );
        };


        // --- Komponen Pembungkus Utama (Provider) ---
        const WalletApp = () => {
            const network = WalletAdapterNetwork.Devnet; 
            const endpoint = useMemo(() => clusterApiUrl(network), [network]);

            const wallets = useMemo(
                () => [
                    new PhantomWalletAdapter(),
                    new SolflareWalletAdapter(),
                ],
                [network]
            );

            const onError = (error) => {
                console.error(`Error Dompet: ${error.name}`, error);
                alert(`Terjadi kesalahan: ${error.message}`);
            };

            return (
                <ConnectionProvider endpoint={endpoint}>
                    <WalletProvider wallets={wallets} onError={onError} autoConnect>
                        <WalletModalProvider>
                            <TransactionAppContent />
                        </WalletModalProvider>
                    </WalletProvider>
                </ConnectionProvider>
            );
        };

        // Render aplikasi React ke DOM
        const container = document.getElementById('root');
        const root = createRoot(container); 
        root.render(<WalletApp />);
    </script>
</body>
</html>
